<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streams Prefetcher</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1 id="page-title" style="cursor: pointer; user-select: none;"><span class="lightning-emoji">‚ö°</span> Streams Prefetcher</h1>
            <p class="subtitle">Warm up your self-hosted addon caches for faster content loading</p>
        </header>

        <!-- Addons Section - Collapsible -->
        <section id="addons" class="card">
            <div class="section-header-collapsible" onclick="toggleSection('addons')">
                <span class="collapse-icon" id="addons-icon">‚ñº</span>
                <h2>üß© Addons</h2>
            </div>

            <div class="collapsible-content" id="addons-content">
                <div class="config-subsection">
                    <h3 class="subsection-title">üîó Addon URLs</h3>
                    <div class="subsection-content">
                        <div class="form-group">
                            <div class="addon-url-sections">
                                <!-- Both Section -->
                                <div class="addon-section" data-type="both">
                                    <h4>
                                        Both (Catalog + Stream)
                                        <span class="info-icon" data-tooltip="Addons that provide both catalog listings and stream links. Most common addon type.">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <circle cx="12" cy="12" r="10"></circle>
                                                <path d="M12 16v-4M12 8h.01"></path>
                                            </svg>
                                        </span>
                                    </h4>
                                    <div class="addon-list" id="addon-list-both"></div>
                                    <button type="button" class="btn btn-sm" onclick="addAddonUrl('both')">+ Add URL</button>
                                </div>

                                <!-- Catalog Section -->
                                <div class="addon-section" data-type="catalog">
                                    <h4>
                                        Catalog Only
                                        <span class="info-icon" data-tooltip="Addons that only provide catalog listings (content discovery). Use with separate stream addons."><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <circle cx="12" cy="12" r="10"></circle>
                                                <path d="M12 16v-4M12 8h.01"></path>
                                            </svg></span>
                                    </h4>
                                    <div class="addon-list" id="addon-list-catalog"></div>
                                    <button type="button" class="btn btn-sm" onclick="addAddonUrl('catalog')">+ Add URL</button>
                                </div>

                                <!-- Stream Section -->
                                <div class="addon-section" data-type="stream">
                                    <h4>
                                        Stream Only
                                        <span class="info-icon" data-tooltip="Addons that only provide stream links. Must be paired with catalog addons."><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <circle cx="12" cy="12" r="10"></circle>
                                                <path d="M12 16v-4M12 8h.01"></path>
                                            </svg></span>
                                    </h4>
                                    <div class="addon-list" id="addon-list-stream"></div>
                                    <button type="button" class="btn btn-sm" onclick="addAddonUrl('stream')">+ Add URL</button>
                                </div>
                            </div>
                            <p style="margin-top: 15px; font-size: 13px; color: var(--text-muted); text-align: center;">
                                üí° <i><b>Tip</b>: Drag and drop addon URLs to another section to change their type</i>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Configuration Section - Collapsible -->
        <section id="configuration" class="card">
            <div class="section-header-collapsible" onclick="toggleSection('configuration')">
                <span class="collapse-icon" id="configuration-icon">‚ñº</span>
                <h2>‚öôÔ∏è Configuration</h2>
            </div>

            <div class="collapsible-content" id="configuration-content">
                <!-- Limits Subsection -->
                <div class="config-subsection">
                    <h3 class="subsection-title">üéØ Limits</h3>
                    <div class="subsection-content">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="movies-global-limit">
                                    Movies Global Limit
                                    <span class="info-icon" data-tooltip="Total maximum number of movie items to prefetch across all catalogs. Check 'Unlimited' for no limit. Default: Unlimited"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <circle cx="12" cy="12" r="10"></circle>
                                                <path d="M12 16v-4M12 8h.01"></path>
                                            </svg></span>
                                </label>
                                <input type="number" id="movies-global-limit" value="200" min="0">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="movies-global-limit-unlimited" checked onchange="toggleUnlimited('movies-global-limit')">
                                    Unlimited
                                </label>
                            </div>

                            <div class="form-group">
                                <label for="series-global-limit">
                                    Series Global Limit
                                    <span class="info-icon" data-tooltip="Total maximum number of series items to prefetch across all catalogs. Check 'Unlimited' for no limit. Default: Unlimited"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <circle cx="12" cy="12" r="10"></circle>
                                                <path d="M12 16v-4M12 8h.01"></path>
                                            </svg></span>
                                </label>
                                <input type="number" id="series-global-limit" value="15" min="0">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="series-global-limit-unlimited" checked onchange="toggleUnlimited('series-global-limit')">
                                    Unlimited
                                </label>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="movies-per-catalog">
                                    Movies per Catalog
                                    <span class="info-icon" data-tooltip="Maximum number of movie items to prefetch from each movie catalog. Check 'Unlimited' for no limit. Default: 50"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <circle cx="12" cy="12" r="10"></circle>
                                                <path d="M12 16v-4M12 8h.01"></path>
                                            </svg></span>
                                </label>
                                <input type="number" id="movies-per-catalog" value="50" min="0">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="movies-per-catalog-unlimited" onchange="toggleUnlimited('movies-per-catalog')">
                                    Unlimited
                                </label>
                            </div>

                            <div class="form-group">
                                <label for="series-per-catalog">
                                    Series per Catalog
                                    <span class="info-icon" data-tooltip="Maximum number of series items to prefetch from each series catalog. Check 'Unlimited' for no limit. Default: 5"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <circle cx="12" cy="12" r="10"></circle>
                                                <path d="M12 16v-4M12 8h.01"></path>
                                            </svg></span>
                                </label>
                                <input type="number" id="series-per-catalog" value="5" min="0">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="series-per-catalog-unlimited" onchange="toggleUnlimited('series-per-catalog')">
                                    Unlimited
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="items-per-mixed-catalog">
                                Items per Mixed Catalog
                                <span class="info-icon" data-tooltip="Maximum number of items to prefetch from catalogs that contain both movies and series. Check 'Unlimited' for no limit. Default: 30"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <circle cx="12" cy="12" r="10"></circle>
                                                <path d="M12 16v-4M12 8h.01"></path>
                                            </svg></span>
                            </label>
                            <input type="number" id="items-per-mixed-catalog" value="30" min="0" style="max-width: 200px;">
                            <label class="checkbox-label">
                                <input type="checkbox" id="items-per-mixed-catalog-unlimited" onchange="toggleUnlimited('items-per-mixed-catalog')">
                                Unlimited
                            </label>
                        </div>

                        <div class="form-group">
                            <label for="max-execution-time">
                                Max Execution Time
                                <span class="info-icon" data-tooltip="Maximum time allowed for a single prefetch job to run. Check 'Unlimited' for no time limit. Default: 90 minutes"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <circle cx="12" cy="12" r="10"></circle>
                                                <path d="M12 16v-4M12 8h.01"></path>
                                            </svg></span>
                            </label>
                            <div class="time-input">
                                <input type="number" id="max-execution-time-value" value="90" min="0" step="0.1">
                                <select id="max-execution-time-unit">
                                    <option value="1">Seconds</option>
                                    <option value="60" selected>Minutes</option>
                                    <option value="3600">Hours</option>
                                    <option value="86400">Days</option>
                                </select>
                            </div>
                            <label class="checkbox-label">
                                <input type="checkbox" id="max-execution-time-unlimited" onchange="toggleUnlimitedTime('max-execution-time')">
                                Unlimited
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Request Subsection -->
                <div class="config-subsection">
                    <h3 class="subsection-title">üåê Request</h3>
                    <div class="subsection-content">
                        <div class="form-group">
                            <label for="delay">
                                Delay Between Requests
                                <span class="info-icon" data-tooltip="Time delay between consecutive stream requests to avoid overloading addons. Default: 2 seconds"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <circle cx="12" cy="12" r="10"></circle>
                                                <path d="M12 16v-4M12 8h.01"></path>
                                            </svg></span>
                            </label>
                            <div class="time-input">
                                <input type="number" id="delay-value" value="2" min="0" step="0.1">
                                <select id="delay-unit">
                                    <option value="0.001">Milliseconds</option>
                                    <option value="1" selected>Seconds</option>
                                    <option value="60">Minutes</option>
                                    <option value="3600">Hours</option>
                                </select>
                            </div>
                            <label class="checkbox-label">
                                <input type="checkbox" id="delay-no-delay" onchange="toggleNoDelay()">
                                No Delay
                            </label>
                        </div>

                        <div class="form-group">
                            <label for="proxy">
                                HTTP Proxy (Optional)
                                <span class="info-icon" data-tooltip="Optional HTTP proxy server for all addon requests. Leave empty if not needed. Format: http://proxy.example.com:8080"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <circle cx="12" cy="12" r="10"></circle>
                                                <path d="M12 16v-4M12 8h.01"></path>
                                            </svg></span>
                            </label>
                            <input type="text" id="proxy" placeholder="http://proxy.example.com:8080">
                        </div>
                    </div>
                </div>

                <!-- Processing Subsection -->
                <div class="config-subsection">
                    <h3 class="subsection-title">üîÆ Processing</h3>
                    <div class="subsection-content">
                        <div class="form-row">
                            <div class="form-group">
                                <label>
                                    Randomize Catalog Processing
                                    <span class="info-icon" data-tooltip="Process catalogs in random order instead of sequential order. Helps distribute load. Default: Disabled"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <circle cx="12" cy="12" r="10"></circle>
                                                <path d="M12 16v-4M12 8h.01"></path>
                                            </svg></span>
                                </label>
                                <div class="radio-group">
                                    <label><input type="radio" name="randomize-catalog" value="true"> Enabled</label>
                                    <label><input type="radio" name="randomize-catalog" value="false" checked> Disabled</label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>
                                    Randomize Item Prefetching
                                    <span class="info-icon" data-tooltip="Fetch items from catalogs in random order instead of sequential order. Default: Disabled"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <circle cx="12" cy="12" r="10"></circle>
                                                <path d="M12 16v-4M12 8h.01"></path>
                                            </svg></span>
                                </label>
                                <div class="radio-group">
                                    <label><input type="radio" name="randomize-item" value="true"> Enabled</label>
                                    <label><input type="radio" name="randomize-item" value="false" checked> Disabled</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Caching & Logging Subsection -->
                <div class="config-subsection">
                    <h3 class="subsection-title">üíæ Caching & Logging</h3>
                    <div class="subsection-content">
                        <div class="form-group">
                            <label for="cache-validity">
                                Skip Prefetching if Already Done Within
                                <span class="info-icon" data-tooltip="Skip prefetching streams for items if they were already prefetched within this time period. Check 'Unlimited' to never re-prefetch items (once done, always skipped). Set to 0 to always prefetch (never skip). Default: 1 week"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <circle cx="12" cy="12" r="10"></circle>
                                                <path d="M12 16v-4M12 8h.01"></path>
                                            </svg></span>
                            </label>
                            <div class="time-input">
                                <input type="number" id="cache-validity-value" value="1" min="0">
                                <select id="cache-validity-unit">
                                    <option value="1">Seconds</option>
                                    <option value="60">Minutes</option>
                                    <option value="3600">Hours</option>
                                    <option value="86400">Days</option>
                                    <option value="604800" selected>Weeks</option>
                                </select>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="cache-validity-unlimited" onchange="toggleUnlimitedTime('cache-validity')">
                                    Unlimited
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>
                                Enable Log File Creation
                                <span class="info-icon" data-tooltip="Enable creation of detailed log files in data/logs directory during prefetch operations. Useful for debugging and monitoring. Default: Disabled"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <circle cx="12" cy="12" r="10"></circle>
                                                <path d="M12 16v-4M12 8h.01"></path>
                                            </svg></span>
                            </label>
                            <div class="radio-group">
                                <label><input type="radio" name="enable-logging" value="true"> Enabled</label>
                                <label><input type="radio" name="enable-logging" value="false" checked> Disabled</label>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </section>
        <!-- Catalog Selection Section -->
        <section id="catalog-selection" class="card">
            <div class="section-header-collapsible" onclick="toggleSection('catalog-selection')">
                <span class="collapse-icon" id="catalog-selection-icon">‚ñº</span>
                <h2>üé¨ Catalog Selection</h2>
            </div>

            <div class="collapsible-content" id="catalog-selection-content">
            <p class="help-text">Load catalogs from your configured addons, then select and order which ones to prefetch</p>

            <button type="button" class="btn btn-secondary" onclick="loadCatalogs()" id="load-catalogs-btn" style="min-width: 150px;">
                Load Catalogs
            </button>

            <div id="catalog-list-container" style="display: none; margin-top: 20px;">
                <div class="form-row" style="margin-bottom: 15px;">
                    <button type="button" class="btn btn-success" onclick="selectAllCatalogs()">
                        Select All
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="deselectAllCatalogs()">
                        Deselect All
                    </button>
                </div>
                <div id="catalog-list" class="catalog-list"></div>
                <p style="margin-top: 15px; font-size: 13px; color: var(--text-muted); text-align: center;">
                    <em>Catalog selections are auto-saved after 2 seconds</em>
                </p>
            </div>
            </div>
        </section>

        <!-- Scheduling Section -->
        <section id="schedule" class="card">
            <div class="section-header-collapsible">
                <span class="collapse-icon" id="schedule-icon" onclick="toggleSection('schedule')">‚ñº</span>
                <h2 onclick="toggleSection('schedule')" style="cursor: pointer; flex: 1;">üìÖ Scheduling</h2>
                <label class="toggle-switch" onclick="event.stopPropagation()">
                    <input type="checkbox" id="scheduling-enabled" onchange="toggleScheduling()">
                    <span class="toggle-slider"></span>
                </label>
            </div>

            <div class="collapsible-content" id="schedule-content">
            <p class="help-text" style="margin-top: 0;">Configure when prefetch jobs should run automatically</p>

            <div id="scheduling-settings" class="scheduling-disabled" style="margin-top: 20px;">
                <!-- Add Schedule Button -->
                <button type="button" class="btn btn-primary" onclick="showAddScheduleModal()" id="add-schedule-btn" disabled>
                    + Add Schedule
                </button>

                <!-- Schedules List -->
                <div id="schedules-list" class="schedules-list">
                    <!-- Schedules will be populated here -->
                </div>

                <!-- Delete All Button (only shows when there are schedules) -->
                <button type="button" class="btn btn-danger" onclick="confirmDeleteAllSchedules()" id="delete-all-btn" style="display: none; margin-top: 15px;">
                    Delete All Schedules
                </button>
            </div>
            </div>
        </section>

        <!-- Add/Edit Schedule Modal -->
        <div id="schedule-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modal-title">Add Schedule</h3>
                    <span class="modal-close" onclick="closeScheduleModal()">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="schedule-time">Time</label>
                        <input type="time" id="schedule-time" required>
                    </div>

                    <div class="form-group">
                        <label>Days of Week</label>
                        <div class="days-selection">
                            <button type="button" class="btn btn-sm" onclick="selectAllDays()">Select All</button>
                            <button type="button" class="btn btn-sm" onclick="deselectAllDays()">Deselect All</button>
                        </div>
                        <div class="days-grid">
                            <label class="day-checkbox">
                                <input type="checkbox" name="day" value="1">
                                <span>Mon</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" name="day" value="2">
                                <span>Tue</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" name="day" value="3">
                                <span>Wed</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" name="day" value="4">
                                <span>Thu</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" name="day" value="5">
                                <span>Fri</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" name="day" value="6">
                                <span>Sat</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" name="day" value="0">
                                <span>Sun</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeScheduleModal()">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveScheduleFromModal()" id="save-schedule-modal-btn">Save</button>
                </div>
            </div>
        </div>

        <!-- Job Status Section -->
        <section id="job-status" class="card job-status-card">
            <h2>üöÄ Prefetch Status</h2>

            <!-- DEBUG PANEL (Hidden by default - Long-press ‚ö° to toggle) -->
            <div id="debug-panel" style="display: none; background: #1a1a1a; border: 3px solid #ff3366; padding: 15px; margin-bottom: 20px; font-family: 'Courier New', monospace; font-size: 11px;">
                <div style="color: #ff3366; font-weight: bold; font-size: 13px; margin-bottom: 10px;">üîç DEBUG LOG (Long-press ‚ö° to toggle)</div>
                <div id="debug-content" style="color: #00ff00; white-space: pre-wrap; word-break: break-all; line-height: 1.4; max-height: 350px; overflow-y: auto; margin-bottom: 10px; padding: 10px; background: #0a0a0a; border: 1px solid #333;"></div>
                <button onclick="copyDebugLog(event)" style="background: #ff3366; color: #fff; border: none; padding: 8px 16px; border-radius: 4px; font-size: 12px; font-weight: bold; cursor: pointer; font-family: 'Courier New', monospace; width: 100%;">üìã COPY ALL LOGS</button>
            </div>

            <!-- Idle State -->
            <div id="status-idle" class="status-display status-idle" style="display: none;">
                <div class="status-icon-wrapper">
                    <div class="status-icon idle-icon">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M12 6v6l4 2"></path>
                        </svg>
                    </div>
                </div>
                <div class="status-message">
                    <h3>Ready to Prefetch</h3>
                    <p>System is ready. Click below to start prefetching streams.</p>
                </div>
                <button type="button" class="btn-modern btn-start" onclick="runJob()" id="start-now-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M8 5v14l11-7z"/>
                    </svg>
                    Start Prefetch Now
                </button>
            </div>

            <!-- Scheduled State -->
            <div id="status-scheduled" class="status-display status-scheduled" style="display: none;">
                <div class="status-icon-wrapper">
                    <div class="status-icon scheduled-icon">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                    </div>
                </div>
                <div class="status-message">
                    <h3>Scheduled</h3>
                    <div id="next-run-info" class="schedule-info"></div>
                </div>
                <button type="button" class="btn-modern btn-start" onclick="runJob()" id="start-now-btn-scheduled">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M8 5v14l11-7z"/>
                    </svg>
                    Start Now
                </button>
            </div>

            <!-- Running State -->
            <div id="status-running" class="status-display status-running" style="display: none;">
                <div class="status-header-running">
                    <div class="status-icon-wrapper">
                        <div class="status-icon running-icon">
                            <div class="spinner-ring"></div>
                            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                        </div>
                    </div>
                    <div class="running-status-text">
                        <h3>Prefetch in Progress</h3>
                        <p class="current-action">Processing catalogs...</p>
                    </div>
                </div>

                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon movies-icon">üé¨</div>
                        <div class="stat-content">
                            <div class="stat-label">Movies</div>
                            <div class="stat-value" id="stat-movies">0</div>
                            <div class="stat-limit" id="stat-movies-limit">of ‚àû</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon series-icon">üì∫</div>
                        <div class="stat-content">
                            <div class="stat-label">Series</div>
                            <div class="stat-value" id="stat-series">0</div>
                            <div class="stat-limit" id="stat-series-limit">of ‚àû</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon episodes-icon">üéûÔ∏è</div>
                        <div class="stat-content">
                            <div class="stat-label">Episodes</div>
                            <div class="stat-value" id="stat-episodes">0</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon cached-icon">‚ö°</div>
                        <div class="stat-content">
                            <div class="stat-label">In Cache</div>
                            <div class="stat-value" id="stat-cached">0</div>
                        </div>
                    </div>
                </div>

                <!-- Page Fetching Status (shows during page loading) -->
                <div class="page-fetch-status" id="page-fetch-status" style="display: none;">
                    <div class="page-fetch-icon">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="rotating">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"></path>
                        </svg>
                    </div>
                    <div class="page-fetch-details">
                        <div class="page-fetch-title">Fetching Page <span id="current-page-number">1</span></div>
                        <div class="page-fetch-subtitle">Discovering items from catalog...</div>
                        <div class="page-fetch-items" id="page-fetch-items">0 items discovered</div>
                    </div>
                </div>

                <!-- Progress Section -->
                <div class="progress-section">
                    <div class="progress-header">
                        <span class="progress-title">Overall Progress</span>
                        <span class="progress-percentage" id="overall-progress-percent">0%</span>
                    </div>
                    <div class="progress-track">
                        <div class="progress-fill" id="overall-progress-fill"></div>
                    </div>
                    <div class="progress-label" id="overall-progress-label">0 of 0 catalogs</div>
                </div>

                <div class="progress-section">
                    <div class="progress-header">
                        <span class="progress-title">Current Catalog: <span id="current-catalog-name" class="catalog-name-highlight">-</span></span>
                        <span class="progress-percentage" id="catalog-progress-percent">0%</span>
                    </div>
                    <div class="progress-track">
                        <div class="progress-fill" id="catalog-progress-fill"></div>
                    </div>
                    <div class="progress-label" id="catalog-progress-label">0 of 0 items</div>
                </div>

                <div class="action-buttons">
                    <button type="button" class="btn-modern btn-terminate" id="terminate-btn"
                            onmousedown="startTerminateCountdown()"
                            onmouseup="cancelTerminateCountdown()"
                            onmouseleave="cancelTerminateCountdown()"
                            ontouchstart="startTerminateCountdown()"
                            ontouchend="cancelTerminateCountdown()"
                            ontouchcancel="cancelTerminateCountdown()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="15" y1="9" x2="9" y2="15"></line>
                            <line x1="9" y1="9" x2="15" y2="15"></line>
                        </svg>
                        Terminate
                    </button>
                </div>
            </div>

            <!-- Completed State -->
            <div id="status-completed" class="status-display status-completed" style="display: none;">
                <div class="completion-header">
                    <div class="status-icon-wrapper">
                        <div class="status-icon completed-icon">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                <polyline points="22 4 12 14.01 9 11.01"></polyline>
                            </svg>
                        </div>
                    </div>
                    <div>
                        <h3>Prefetch Complete!</h3>
                        <p class="completion-subtitle">All operations completed successfully</p>
                    </div>
                </div>

                <!-- Timing Overview -->
                <div class="completion-section">
                    <h4 class="completion-section-title">‚è±Ô∏è Timing Overview</h4>
                    <div class="timing-grid">
                        <div class="timing-card">
                            <div class="timing-label">Started</div>
                            <div class="timing-value" id="completion-start-time">-</div>
                        </div>
                        <div class="timing-card">
                            <div class="timing-label">Finished</div>
                            <div class="timing-value" id="completion-end-time">-</div>
                        </div>
                        <div class="timing-card">
                            <div class="timing-label">Total Duration</div>
                            <div class="timing-value highlight" id="completion-total-duration">-</div>
                        </div>
                        <div class="timing-card">
                            <div class="timing-label">Processing Time</div>
                            <div class="timing-value" id="completion-processing-time">-</div>
                        </div>
                    </div>
                </div>

                <!-- Statistics Grid -->
                <div class="completion-section">
                    <h4 class="completion-section-title">üìä Statistics</h4>
                    <div class="stats-summary-grid">
                        <div class="summary-stat">
                            <div class="summary-stat-icon">üìÅ</div>
                            <div class="summary-stat-value" id="completion-catalogs">0</div>
                            <div class="summary-stat-label">Catalogs Processed</div>
                        </div>
                        <div class="summary-stat">
                            <div class="summary-stat-icon">üé¨</div>
                            <div class="summary-stat-value" id="completion-movies">0</div>
                            <div class="summary-stat-label">Movies Prefetched</div>
                        </div>
                        <div class="summary-stat">
                            <div class="summary-stat-icon">üì∫</div>
                            <div class="summary-stat-value" id="completion-series">0</div>
                            <div class="summary-stat-label">Series Prefetched</div>
                        </div>
                        <div class="summary-stat">
                            <div class="summary-stat-icon">üéûÔ∏è</div>
                            <div class="summary-stat-value" id="completion-episodes">0</div>
                            <div class="summary-stat-label">Episodes Prefetched</div>
                        </div>
                        <div class="summary-stat">
                            <div class="summary-stat-icon">üìÑ</div>
                            <div class="summary-stat-value" id="completion-pages">0</div>
                            <div class="summary-stat-label">Pages Fetched</div>
                        </div>
                        <div class="summary-stat">
                            <div class="summary-stat-icon">‚ö°</div>
                            <div class="summary-stat-value" id="completion-cached">0</div>
                            <div class="summary-stat-label">In Cache</div>
                        </div>
                        <div class="summary-stat">
                            <div class="summary-stat-icon">‚úì</div>
                            <div class="summary-stat-value highlight" id="completion-success-rate">0%</div>
                            <div class="summary-stat-label">Success Rate</div>
                        </div>
                    </div>
                </div>

                <!-- Processing Rates -->
                <div class="completion-section">
                    <h4 class="completion-section-title">‚ö° Processing Rates</h4>
                    <div class="rate-cards">
                        <div class="rate-card">
                            <div class="rate-value" id="completion-movie-rate">-</div>
                            <div class="rate-label">Movies/min</div>
                        </div>
                        <div class="rate-card">
                            <div class="rate-value" id="completion-series-rate">-</div>
                            <div class="rate-label">Episodes/min</div>
                        </div>
                        <div class="rate-card">
                            <div class="rate-value" id="completion-overall-rate">-</div>
                            <div class="rate-label">Items/min</div>
                        </div>
                    </div>
                </div>

                <!-- Catalog Details Table -->
                <div class="completion-section">
                    <h4 class="completion-section-title">üìã Catalog Details</h4>
                    <div class="catalog-table-wrapper">
                        <table class="catalog-details-table">
                            <thead>
                                <tr>
                                    <th>Catalog</th>
                                    <th>Type</th>
                                    <th>Duration</th>
                                    <th>Success</th>
                                    <th>Failed</th>
                                    <th>Cached</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody id="catalog-details-tbody">
                                <tr>
                                    <td colspan="7" style="text-align: center; padding: 20px; color: var(--text-muted);">
                                        No data available
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Action Button -->
                <div class="completion-actions">
                    <button type="button" class="btn-modern btn-secondary" onclick="dismissCompletion()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                        Dismiss
                    </button>
                </div>
            </div>

            <!-- Failed/Error State -->
            <div id="status-failed" class="status-display status-failed" style="display: none;">
                <div class="error-header">
                    <div class="status-icon-wrapper">
                        <div class="status-icon error-icon">
                            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="8" x2="12" y2="12"></line>
                                <line x1="12" y1="16" x2="12.01" y2="16"></line>
                            </svg>
                        </div>
                    </div>
                    <h3 class="error-title">Prefetch Job Failed</h3>
                    <p class="error-subtitle">An error occurred while running the prefetch job</p>
                </div>

                <div class="error-content">
                    <div class="error-details-card">
                        <div class="error-details-header">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                                <line x1="12" y1="9" x2="12" y2="13"></line>
                                <line x1="12" y1="17" x2="12.01" y2="17"></line>
                            </svg>
                            <span>Error Details</span>
                        </div>
                        <div class="error-message" id="error-message">
                            An unexpected error occurred
                        </div>
                        <div class="error-timestamp" id="error-timestamp">
                            <!-- Timestamp will be inserted here -->
                        </div>
                    </div>

                    <div class="error-help-card">
                        <div class="error-help-header">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <line x1="12" y1="17" x2="12.01" y2="17"></line>
                            </svg>
                            <span>What to try</span>
                        </div>
                        <ul class="error-suggestions">
                            <li>Check your configuration settings and addon URLs</li>
                            <li>Ensure at least one catalog is selected</li>
                            <li>Verify your network connection</li>
                            <li>Check container logs for detailed error information</li>
                        </ul>
                    </div>
                </div>

                <!-- Action Button -->
                <div class="error-actions">
                    <button type="button" class="btn-modern btn-error-dismiss" onclick="dismissError()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                        Dismiss
                    </button>
                </div>
            </div>
        </section>

        <!-- Reset to Defaults Section -->
        <section class="reset-section">
            <button type="button" class="btn-reset" id="reset-all-btn"
                    onmousedown="startResetCountdown()"
                    onmouseup="cancelResetCountdown()"
                    onmouseleave="cancelResetCountdown()"
                    ontouchstart="startResetCountdown()"
                    ontouchend="cancelResetCountdown()"
                    ontouchcancel="cancelResetCountdown()">
                Reset to Defaults
            </button>
        </section>

        <footer>
            <p>Streams Prefetcher v2.0 | For self-hosted addons only</p>
        </footer>
    </div>

    <script src="/js/app.js"></script>
</body>
</html>
